[gd_scene load_steps=8 format=2]

[ext_resource path="res://Resources/manaspc.ttf" type="DynamicFontData" id=1]
[ext_resource path="res://Resources/UI/Arrow_Right.png" type="Texture" id=2]
[ext_resource path="res://Resources/UI/Arrow_Left.png" type="Texture" id=4]

[sub_resource type="GDScript" id=4]
script/source = "extends Node2D

const MainScene = \"res://Main.tscn\"
const CreditsScene = \"res://Menu/Credits.tscn\"
const SettingsScene = \"res://Menu/Settings.tscn\"

onready var selection = $Selection
onready var tween = $Tween

var buttons: Array
var disable_buttons: bool = false

func _ready():
	buttons = [
		$Controls/CenterContainer/VBoxContainer/PlayButton,
		$Controls/CenterContainer/VBoxContainer/OptionsButton,
		$Controls/CenterContainer/VBoxContainer/CreditsButton,
		$Controls/CenterContainer/VBoxContainer/ExitButton,
	]
	animate_scene_start()


func _on_Button_mouse_entered(index: int) -> void:
	var button: Button = buttons[index]
	var pos_y = button.rect_global_position.y + button.rect_size.y / 2
	selection.global_position.y = pos_y
	selection.visible = true
	AudioManager.play_effect(\"hover\")


func _on_Button_mouse_exited(_index: int) -> void:
	selection.visible = false


func button_selected() -> void:
	if disable_buttons:
		return

	disable_buttons = true
	$Selection.visible = false
	yield(AudioManager.play_effect(\"select\"), \"completed\")
	


func animate_scene_start() -> void:
	var controls = $Controls
	tween.interpolate_property(
		controls,
		\"position\",
		controls.position - Vector2(0, 650),
		controls.position,
		0.7,
		Tween.TRANS_ELASTIC, 
		Tween.EASE_IN_OUT,
		0
	)
	controls.position -= Vector2(0, 650)
	tween.start()

func animate_scene_end(new_scene_path: String) -> void:
	tween.stop_all()

	var controls = $Controls
	tween.interpolate_property(
		controls,
		\"position\",
		controls.position,
		controls.position + Vector2(0, 650),
		0.6,
		Tween.TRANS_ELASTIC, 
		Tween.EASE_IN_OUT,
		0.1
	)
	
	tween.start()
	yield(tween, \"tween_all_completed\")
	assert(get_tree().change_scene(new_scene_path) == OK)
	
	

func play() -> void:
	button_selected()
	animate_scene_end(MainScene)
	
func show_options() -> void:
	button_selected()
	animate_scene_end(SettingsScene)

func show_credits() -> void:
	button_selected()
	animate_scene_end(CreditsScene)

func exit():
	yield(button_selected(), \"completed\")
	get_tree().quit()
"

[sub_resource type="Gradient" id=1]
colors = PoolColorArray( 0.286275, 0.584314, 0.701961, 1, 0.85098, 0.945098, 0.972549, 1 )

[sub_resource type="GradientTexture" id=2]
gradient = SubResource( 1 )

[sub_resource type="DynamicFont" id=3]
size = 40
outline_size = 1
outline_color = Color( 0, 0, 0, 1 )
font_data = ExtResource( 1 )

[node name="Menu" type="Node2D"]
script = SubResource( 4 )

[node name="Background" type="Node2D" parent="."]

[node name="Sprite" type="Sprite" parent="Background"]
position = Vector2( 531.742, 160.394 )
rotation = -1.5708
scale = Vector2( 0.449064, 1091.92 )
texture = SubResource( 2 )

[node name="Selection" type="Node2D" parent="."]
visible = false
position = Vector2( 513.065, 223.105 )
scale = Vector2( 2, 2 )

[node name="ArrowRight" type="Sprite" parent="Selection"]
position = Vector2( -65, -1.185 )
texture = ExtResource( 2 )

[node name="ArrowLeft" type="Sprite" parent="Selection"]
visible = false
texture = ExtResource( 4 )
offset = Vector2( 70, 0 )

[node name="Controls" type="Node2D" parent="."]

[node name="CenterContainer" type="CenterContainer" parent="Controls"]
margin_right = 1024.0
margin_bottom = 600.0
grow_vertical = 2
__meta__ = {
"_edit_use_anchors_": false
}

[node name="VBoxContainer" type="VBoxContainer" parent="Controls/CenterContainer"]
margin_left = 411.0
margin_top = 202.0
margin_right = 612.0
margin_bottom = 398.0
grow_horizontal = 2
grow_vertical = 2
__meta__ = {
"_edit_use_anchors_": false
}

[node name="PlayButton" type="Button" parent="Controls/CenterContainer/VBoxContainer"]
margin_right = 201.0
margin_bottom = 46.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = SubResource( 3 )
text = "Play"
flat = true
align = 0

[node name="OptionsButton" type="Button" parent="Controls/CenterContainer/VBoxContainer"]
margin_top = 50.0
margin_right = 201.0
margin_bottom = 96.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = SubResource( 3 )
text = "Options"
flat = true
align = 0

[node name="CreditsButton" type="Button" parent="Controls/CenterContainer/VBoxContainer"]
margin_top = 100.0
margin_right = 201.0
margin_bottom = 146.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = SubResource( 3 )
text = "Credits"
flat = true
align = 0

[node name="ExitButton" type="Button" parent="Controls/CenterContainer/VBoxContainer"]
margin_top = 150.0
margin_right = 201.0
margin_bottom = 196.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = SubResource( 3 )
text = "Exit"
flat = true
align = 0

[node name="Tween" type="Tween" parent="."]
[connection signal="mouse_entered" from="Controls/CenterContainer/VBoxContainer/PlayButton" to="." method="_on_Button_mouse_entered" binds= [ 0 ]]
[connection signal="mouse_exited" from="Controls/CenterContainer/VBoxContainer/PlayButton" to="." method="_on_Button_mouse_exited" binds= [ 0 ]]
[connection signal="pressed" from="Controls/CenterContainer/VBoxContainer/PlayButton" to="." method="play"]
[connection signal="mouse_entered" from="Controls/CenterContainer/VBoxContainer/OptionsButton" to="." method="_on_Button_mouse_entered" binds= [ 1 ]]
[connection signal="mouse_exited" from="Controls/CenterContainer/VBoxContainer/OptionsButton" to="." method="_on_Button_mouse_exited" binds= [ 1 ]]
[connection signal="pressed" from="Controls/CenterContainer/VBoxContainer/OptionsButton" to="." method="show_options"]
[connection signal="mouse_entered" from="Controls/CenterContainer/VBoxContainer/CreditsButton" to="." method="_on_Button_mouse_entered" binds= [ 2 ]]
[connection signal="mouse_exited" from="Controls/CenterContainer/VBoxContainer/CreditsButton" to="." method="_on_Button_mouse_exited" binds= [ 2 ]]
[connection signal="pressed" from="Controls/CenterContainer/VBoxContainer/CreditsButton" to="." method="show_credits"]
[connection signal="mouse_entered" from="Controls/CenterContainer/VBoxContainer/ExitButton" to="." method="_on_Button_mouse_entered" binds= [ 3 ]]
[connection signal="mouse_exited" from="Controls/CenterContainer/VBoxContainer/ExitButton" to="." method="_on_Button_mouse_exited" binds= [ 3 ]]
[connection signal="pressed" from="Controls/CenterContainer/VBoxContainer/ExitButton" to="." method="exit"]
